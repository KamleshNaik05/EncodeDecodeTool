<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AES Secure Messenger</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
*{
    box-sizing:border-box;
    margin:0;
    padding:0;
    font-family:'Segoe UI','Poppins',sans-serif;
}
body{
    min-height:100vh;
    background:linear-gradient(135deg,#6a11cb,#2575fc);
    display:flex;
    justify-content:center;
    align-items:center;
    padding:20px;
}
.card{
    background:rgba(255,255,255,0.95);
    width:100%;
    max-width:540px;
    border-radius:20px;
    padding:30px;
    box-shadow:0 20px 50px rgba(0,0,0,0.25);
}
.header{
    display:flex;
    justify-content:center;
    align-items:center;
    gap:12px;
    margin-bottom:20px;
}
.header i{font-size:26px;color:#6a11cb;}
h1{
    font-size:26px;
    background:linear-gradient(135deg,#6a11cb,#2575fc);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
}
.subtitle{
    text-align:center;
    color:#666;
    margin-bottom:20px;
    font-size:14px;
}
label{font-weight:600;margin-bottom:6px;display:block;}
input,textarea{
    width:100%;
    padding:14px;
    border-radius:12px;
    border:2px solid #e0e0e0;
    font-size:15px;
    outline:none;
    margin-bottom:12px;
}
textarea{min-height:120px;resize:vertical;}
button{
    width:100%;
    padding:14px;
    font-size:16px;
    border:none;
    border-radius:12px;
    cursor:pointer;
    font-weight:700;
}
.action-btn{
    background:linear-gradient(135deg,#6a11cb,#2575fc);
    color:white;
    margin-bottom:12px;
}
.process-btn{
    background:#333;
    color:white;
    margin-bottom:15px;
}
.copy-btn{
    width:auto;
    padding:6px 12px;
    font-size:13px;
    background:#f0f0f0;
}
.footer{
    text-align:center;
    margin-top:15px;
    font-size:13px;
    color:#777;
}
</style>
</head>

<body>

<div class="card">
    <div class="header">
        <i class="fas fa-lock"></i>
        <h1>AES Secure Messenger</h1>
    </div>

    <p class="subtitle">AES Encryption ‚Ä¢ Hash ‚Ä¢ Tamper Detection ‚Ä¢ Expiry</p>

    <label>Message</label>
    <textarea id="message" placeholder="Enter your message..."></textarea>

    <label>Secret Password</label>
    <input type="password" id="password" placeholder="Shared secret password">

    <label>Expiry Time (minutes)</label>
    <input type="number" id="expiry" placeholder="Example: 5" min="1">

    <button class="process-btn" id="processBtn">
        <i class="fas fa-cogs"></i> Process
    </button>

    <label>Result</label>
    <textarea id="result" readonly placeholder="Encrypted / Decrypted result"></textarea>

    <div style="text-align:right;">
        <button class="copy-btn" id="copyBtn">
            <i class="fas fa-copy"></i> Copy
        </button>
    </div>

    <div class="footer">
        Message auto-expires after specified time
    </div>
</div>

<script>
const msg = document.getElementById("message");
const pwd = document.getElementById("password");
const exp = document.getElementById("expiry");
const res = document.getElementById("result");
const processBtn = document.getElementById("processBtn");
const copyBtn = document.getElementById("copyBtn");

const enc = new TextEncoder();
const dec = new TextDecoder();

function bufToBase64(buf){
    return btoa(String.fromCharCode(...new Uint8Array(buf)));
}
function base64ToBuf(b64){
    return Uint8Array.from(atob(b64), c => c.charCodeAt(0));
}

async function sha256(text){
    const hash = await crypto.subtle.digest("SHA-256", enc.encode(text));
    return bufToBase64(hash);
}

async function deriveKey(password, salt){
    const keyMaterial = await crypto.subtle.importKey(
        "raw", enc.encode(password), "PBKDF2", false, ["deriveKey"]
    );
    return crypto.subtle.deriveKey(
        { name:"PBKDF2", salt, iterations:100000, hash:"SHA-256" },
        keyMaterial,
        { name:"AES-GCM", length:256 },
        false,
        ["encrypt","decrypt"]
    );
}

async function encryptAES(payload, password){
    const salt = crypto.getRandomValues(new Uint8Array(16));
    const iv = crypto.getRandomValues(new Uint8Array(12));
    const key = await deriveKey(password, salt);
    const cipher = await crypto.subtle.encrypt(
        { name:"AES-GCM", iv },
        key,
        enc.encode(payload)
    );
    return {
        salt: bufToBase64(salt),
        iv: bufToBase64(iv),
        data: bufToBase64(cipher)
    };
}

async function decryptAES(payload, password){
    const salt = base64ToBuf(payload.salt);
    const iv = base64ToBuf(payload.iv);
    const data = base64ToBuf(payload.data);
    const key = await deriveKey(password, salt);
    const plain = await crypto.subtle.decrypt(
        { name:"AES-GCM", iv },
        key,
        data
    );
    return dec.decode(plain);
}

processBtn.onclick = async () => {
    try{
        if(msg.value.trim().startsWith("{")){
            // DECODE
            const payload = JSON.parse(msg.value);
            const decrypted = await decryptAES(payload, pwd.value);
            const obj = JSON.parse(decrypted);

            if(Date.now() > obj.expiry){
                res.value = "‚è≥ Message expired. Access denied.";
                return;
            }

            const verifyHash = await sha256(obj.message);
            if(verifyHash !== obj.hash){
                res.value = "üö® Tampering detected!";
                return;
            }

            res.value = obj.message;
        }else{
            // ENCODE
            const minutes = Number(exp.value);
            if(!minutes || minutes <= 0){
                res.value = "‚ö†Ô∏è Enter valid expiry time.";
                return;
            }

            const expiryTime = Date.now() + minutes * 60000;
            const hash = await sha256(msg.value);

            const encrypted = await encryptAES(
                JSON.stringify({
                    message: msg.value,
                    hash,
                    expiry: expiryTime
                }),
                pwd.value
            );

            res.value = JSON.stringify(encrypted);
        }
    }catch{
        res.value = "‚ùå Wrong password or corrupted data.";
    }
};

copyBtn.onclick = () => {
    if(res.value) navigator.clipboard.writeText(res.value);
};
</script>

</body>
</html>
